---

# This batch scenario will give you a Cloud 8 deployment suitable for
# performing a disruptive (normal) upgrade to Cloud 9. You can apply it to a cloud
# with Crowbar already installed (no OpenStack barclamps applied, yet).
#
# Before you apply this batch scenario, you will need to ensure the following
# aliases exist in Crowbar and point to nodes suitable as controllers and
# compute nodes, respectively:
#
#    * controller1
#    * controller2
#    * controller3
#    * compute1
#    * compute2
#    * compute3
#
# Once you have made these alias assignments, copy this scenario file to your
# Crowbar node's /root directory and apply it using the follow command:
#
#    crowbar batch --timeout 3600 build /root/scenario-nondisruptive.yaml

proposals:
- barclamp: pacemaker
  name: services
  attributes:
    stonith:
      mode: ipmi_barclamp
      sbd:
        nodes:
          @@controller1@@:
            devices:
            - ''
          @@controller2@@:
            devices:
            - ''
          @@controller3@@:
            devices:
            - ''
      per_node:
        nodes:
          @@controller1@@:
            params: ''
          @@controller2@@:
            params: ''
          @@controller3@@:
            params: ''
    drbd:
      enabled: false
  deployment:
    elements:
      pacemaker-cluster-member:
      - @@controller1@@
      - @@controller2@@
      - @@controller3@@
      hawk-server:
      - @@controller1@@
      - @@controller2@@
      - @@controller3@@

- barclamp: database
  attributes:
  deployment:
    elements:
      database-server:
      - cluster:services

- barclamp: rabbitmq
  wipe_attributes:
    - tcp_listen_options.nodelay
    - tcp_listen_options.keepalive
  attributes:
    password: c7Wyt6pyvQOm
    user: nova
    vhost: nova
    trove:
      password: pUz4siOKYIbs
    tcp_listen_options: {}
  deployment:
    elements:
      rabbitmq-server:
      - cluster:services

- barclamp: keystone
  attributes:
    database_instance: default
    rabbitmq_instance: default
    db:
      password: Sf8HvQUDEiix
    service:
      token: VGyNTegIjUrf
    osprofiler:
      hmac_keys:
      - EJ94gJp4Tmq6
    federation:
      openidc:
        passphrase: toqHwzsDDOoh
  deployment:
    elements:
      keystone-server:
      - cluster:services

- barclamp: swift
  attributes:
    dispersion:
      service_password: m9aJ5Rx9CJaA
    container_sync:
      key: M8imrbJRrEYG
      key2: rAw886XWsdQe
    cluster_hash: 14ed078703
    replicas: 2
    keystone_instance: default
    service_password: qDvkkKdVzl9T
  deployment:
    elements:
      swift-dispersion:
      - "@@controller1@@"
      swift-proxy:
      - cluster:services
      swift-ring-compute:
      - "@@controller1@@"
      swift-storage:
      - "@@compute1@@"
      - "@@compute2@@"
      - "@@compute3@@"

- barclamp: glance
  attributes:
    service_password: BiyePeUGq90Y
    db:
      password: zDexSLHibaDt
    default_store: swift
    keystone_instance: default
    database_instance: default
    rabbitmq_instance: default
    memcache_secret_key: AuJZSgK4UafJ
  deployment:
    elements:
      glance-server:
      - cluster:services

- barclamp: cinder
  attributes:
    rabbitmq_instance: default
    keystone_instance: default
    glance_instance: default
    database_instance: default
    service_password: 0zrW0KLlve4A
    memcache_secret_key: Sl4FFGcMiiT8
    keymgr_fixed_key: O01ZIIvCHn4s
    volumes:
    - backend_driver: local
      backend_name: default
      local:
        volume_name: cinder-volumes
        file_name: "/var/lib/cinder/volume.raw"
        file_size: 2000
    db:
      password: HnxmeS391bcX
  deployment:
    elements:
      cinder-controller:
      - cluster:services
      cinder-volume:
      - @@controller1@@
      - @@controller2@@
      - @@controller3@@

- barclamp: neutron
  attributes:
    service_password: IS1445OmgFkt
    rabbitmq_instance: default
    keystone_instance: default
    memcache_secret_key: BClsEOJKBiiK
    l3_ha:
      vrrp_password: o2t0aeJiQ14F
    ml2_type_drivers:
    - 'vlan'
    num_vlans: 99
    ml2_type_drivers_default_provider_network: 'vlan'
    ml2_type_drivers_default_tenant_network: 'vlan'
    apic:
      opflex:
      - pod: ''
        nodes: []
        peer_ip: ''
        peer_port: 8009
        encap: vxlan
        vxlan:
          encap_iface: br-int_vxlan0
          uplink_iface: vlan.4093
          uplink_vlan: 4093
          remote_ip: ''
          remote_port: 8472
        vlan:
          encap_iface: ''
        integration_bridge: br-int
        access_bridge: br-fabric
    database_instance: default
    db:
      password: sNhTTmsNvH7s
    sql:
      max_pool_size: 60
      max_pool_overflow: 10
  deployment:
    elements:
      neutron-server:
      - cluster:services
      neutron-network:
      - cluster:services

- barclamp: nova
  attributes:
    service_password: IWlImC8Ca149
    placement_service_password: fk3VwDwaeKER
    neutron_metadata_proxy_shared_secret: vC8OvM03BrBX
    database_instance: default
    rabbitmq_instance: default
    keystone_instance: default
    glance_instance: default
    cinder_instance: default
    neutron_instance: default
    memcache_secret_key: PtuTiEJV09N1
    itxt_instance: ''
    use_migration: true
    kvm:
      ksm_enabled: true
    metadata:
      vendordata:
        json: '{"custom-key": "custom-value"}'
    compute_remotefs_sshkey: |
      -----BEGIN OPENSSH PRIVATE KEY-----
      b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
      QyNTUxOQAAACD+ALtRhH6X8bWKFHwjk329RFyvFQTbddpia9VeW7i1TQAAAJDBB/NGwQfz
      RgAAAAtzc2gtZWQyNTUxOQAAACD+ALtRhH6X8bWKFHwjk329RFyvFQTbddpia9VeW7i1TQ
      AAAEB7nSKb9yR4yiQxX3+XvWjqOYF5v/mLxatqPkqLTpzZvv4Au1GEfpfxtYoUfCOTfb1E
      XK8VBNt12mJr1V5buLVNAAAADWNyb3diYXJAYWRtaW4=
      -----END OPENSSH PRIVATE KEY-----
    ec2-api:
      db:
        password: Fwph6tdCyGO8
    db:
      password: EHgjO2lPP8vB
    api_db:
      password: v9wyjuS0vgUK
    placement_db:
      password: o96WUwhFOFd1
  deployment:
    elements:
      ec2-api:
      - cluster:services
      nova-controller:
      - cluster:services
      nova-compute-kvm:
      - remotes:services
      nova-compute-qemu: []

- barclamp: horizon
  attributes:
    keystone_instance: default
    database_instance: default
    secret_key: 1Jbt4SLz0xEj
    db:
      password: OZMSllRpWc2k
  deployment:
    elements:
      horizon-server:
      - cluster:services
